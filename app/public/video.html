<video id="videoElement" autoplay playsinline></video>
<canvas id="canvas" style="display: none;"></canvas>
<button id="captureButton">Capturar Foto</button>
<button id="parar">parar</button>
<button onclick="getCameraStream();">iniciar</button>
<img id="capturedImage" src="" alt="Captured Image">
<a id="downloadButton" download="captured_image.png">Download</a>

<script>
    let stream;
    const videoElement = document.getElementById('videoElement');
    let canvas = document.querySelector('#canvas');
    let ctx = canvas.getContext('2d');
    let captureButton = document.querySelector('#captureButton');
    let capturedImage = document.querySelector('#capturedImage');
    let downloadButton = document.querySelector('#downloadButton');
    let parar = document.querySelector('#parar');

    parar.onclick = () => {
        const tracks = stream.getTracks();
        tracks.forEach(track => track.stop());
    }

    videoElement.addEventListener('loadedmetadata', function () {
        // Configurar as dimensões do canvas para corresponder às dimensões do vídeo
        canvas.width = videoElement.videoWidth;
        canvas.height = videoElement.videoHeight;
        console.log('tamanho:', canvas.width, canvas.height);
    });

    async function getCameraStream() {
        try {
            // Solicitar permissão para acessar a câmera
            stream = await navigator.mediaDevices.getUserMedia({ video: true });

            // Exibir o vídeo da câmera no elemento de vídeo
            videoElement.srcObject = stream;
            return stream;
        } catch (error) { console.error('Erro ao acessar a câmera:', error); }
    }
    getCameraStream();
    captureButton.addEventListener('click', function () {
        ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
        canvas.toBlob(function (blob) {
            const imageUrl = URL.createObjectURL(blob);
            capturedImage.src = imageUrl;
            downloadButton.href = imageUrl;

            setTimeout(() => { URL.revokeObjectURL(imageUrl); }, 5000);
        });
    });

</script>